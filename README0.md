# devops-netology

### «3.7. Компьютерные сети, лекция 2»
1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?
---
```buildoutcfg
C:\Users\Kashnerok>ipconfig /all

Настройка протокола IP для Windows

   Имя компьютера  . . . . . . . . . : HUAN-PC
   Основной DNS-суффикс  . . . . . . :
   Тип узла. . . . . . . . . . . . . : Гибридный
   IP-маршрутизация включена . . . . : Нет
   WINS-прокси включен . . . . . . . : Нет

Адаптер Ethernet VirtualBox Host-Only Network:

   DNS-суффикс подключения . . . . . :
   Описание. . . . . . . . . . . . . : VirtualBox Host-Only Ethernet Adapter
   Физический адрес. . . . . . . . . : 0A-00-27-00-00-1C
   DHCP включен. . . . . . . . . . . : Нет
   Автонастройка включена. . . . . . : Да
   Локальный IPv6-адрес канала . . . : fe80::5930:f462:a8de:5b63%28(Основной)
   IPv4-адрес. . . . . . . . . . . . : 192.168.56.1(Основной)
   Маска подсети . . . . . . . . . . : 255.255.255.0
   Основной шлюз. . . . . . . . . :
   IAID DHCPv6 . . . . . . . . . . . : 470417447
   DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-28-4C-8B-C1-00-E0-4C-A1-00-D1
   DNS-серверы. . . . . . . . . . . : fec0:0:0:ffff::1%1
                                       fec0:0:0:ffff::2%1
                                       fec0:0:0:ffff::3%1
   NetBios через TCP/IP. . . . . . . . : Включен

Адаптер Ethernet Ethernet:

   DNS-суффикс подключения . . . . . :
   Описание. . . . . . . . . . . . . : Realtek PCIe GbE Family Controller
   Физический адрес. . . . . . . . . : 00-E0-4C-A1-00-D1
   DHCP включен. . . . . . . . . . . : Да
   Автонастройка включена. . . . . . : Да
   Локальный IPv6-адрес канала . . . : fe80::5c38:d5f8:432:d4d7%3(Основной)
   IPv4-адрес. . . . . . . . . . . . : 192.168.2.42(Основной)
   Маска подсети . . . . . . . . . . : 255.255.255.0
   Аренда получена. . . . . . . . . . : 7 января 2022 г. 11:01:58
   Срок аренды истекает. . . . . . . . . . : 7 января 2022 г. 21:31:58
   Основной шлюз. . . . . . . . . : 192.168.2.1
   DHCP-сервер. . . . . . . . . . . : 192.168.2.1
   IAID DHCPv6 . . . . . . . . . . . : 50389068
   DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-28-4C-8B-C1-00-E0-4C-A1-00-D1
   DNS-серверы. . . . . . . . . . . : 192.168.2.1
   NetBios через TCP/IP. . . . . . . . : Включен

Адаптер Ethernet Сетевое подключение Bluetooth 2:

   Состояние среды. . . . . . . . : Среда передачи недоступна.
   DNS-суффикс подключения . . . . . :
   Описание. . . . . . . . . . . . . : Bluetooth Device (Personal Area Network) #2
   Физический адрес. . . . . . . . . : 00-1A-7D-DA-71-15
   DHCP включен. . . . . . . . . . . : Да
   Автонастройка включена. . . . . . : Да

C:\Users\Kashnerok>
```

```buildoutcfg
root@ubuntu-focal:/home/vagrant# ip -c -br a
lo               UNKNOWN        127.0.0.1/8 ::1/128
enp0s3           UP             10.0.2.15/24 fe80::78:6cff:fe8f:22ad/64
root@ubuntu-focal:/home/vagrant#
```

---
---
2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?
---
Вообще для этого используется команда _lldpctl_ из пакета _lldpd_, но в моем случае машина в VirtualBox подключена через NAT, в других режимах я не могу достучаться до хостовой машины по ssh.
Видимо поэтому у меня эта команда ничего не показывает:
```buildoutcfg
root@ubuntu-focal:/home/vagrant# lldpctl
-------------------------------------------------------------------------------
LLDP neighbors:
-------------------------------------------------------------------------------
root@ubuntu-focal:/home/vagrant#
```
В принципе можно еще посмотреть ARP-таблицу:
```buildoutcfg
root@ubuntu-focal:/home/vagrant# ip neighbour
10.0.2.2 dev enp0s3 lladdr 52:54:00:12:35:02 DELAY
root@ubuntu-focal:/home/vagrant#
```

---
---

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.
---
Эта технология называется VLAN. В Ubuntu для этого можно установить пакет vlan. 
Пример конфига:
```buildoutcfg
auto enp0s3.200
iface enp0s3.200 inet static
    address 10.10.10.1
    netmask 255.255.255.0
    vlan-raw-device enp0s3
```
В этом примере на интерфейс enp0s3 был прописан 200-й VLAN и назначен ip 10.10.10.1.

---
---
4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.
---
Linux поддерживает несколько режимов агрегации интерфейсов:
* 0 (balance-rr) — round-robin распределение пакетов между интерфейсами. Обеспечивает отказоустойчивость и повышение пропускной способности.
* 1 (active-backup) — в каждый момент времени работает только один интерфейс, в случае его выхода из строя, mac-адрес назначается второму интерфейсу и трафик переключается на него.
* 2 (balance-xor) — обеспечивает балансировку между интерфейсами на основании MAC-адресов отправителя и получателя.
* 3 (broadcast) — отправляет пакеты через все интерфейсы одновременно, обеспечивает отказоустойчивость.
* 4 (802.3ad) — обеспечивает агрегацию на основании протокола 802.3ad.
* 5 (balance-tlb) — в этом режиме входящий трафик приходит только на один «активный» интерфейс, исходящий же распределяется по всем интерфейсам.
* 6 (balance-alb) — балансирует исходящий трафик как tlb, а так же входящий IPv4 трафик используя ARP.

Примеры конфигов:
/etc/network/interfaces
```buildoutcfg
auto bond0
iface bond0 inet static
        address 192.168.0.2
        netmask 255.255.255.0
        network 192.168.0.0
        broadcast 192.168.0.255
        gateway 192.168.0.1
        up /sbin/ifenslave bond0 eth0 eth1
        down /sbin/ifenslave -d bond0 eth0 eth1
```
/etc/modprobe.d/bonding.conf
```buildoutcfg
alias bond0 bonding
options bonding mode=0 miimon=100 downdelay=200 updelay=200
```
/etc/modules
```buildoutcfg
echo "bonding" >> /etc/modules
```
Если всё верно, то должно получиться примерно так:
```buildoutcfg
root@localhost:~$ ifconfig
bond0     Link encap:Ethernet  HWaddr 00:1e:58:99:f2:a0
          inet addr:192.168.0.2  Bcast:192.168.0.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1
          RX packets:6533845 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6583132 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:3584238626 (3.3 GiB)  TX bytes:5339636447 (4.9 GiB)

eth0      Link encap:Ethernet  HWaddr 00:1e:58:99:f2:a0
          UP BROADCAST RUNNING SLAVE MULTICAST  MTU:1500  Metric:1
          RX packets:3741006 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3291562 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1893688937 (1.7 GiB)  TX bytes:2677192063 (2.4 GiB)
          Interrupt:21

eth1      Link encap:Ethernet  HWaddr 00:1e:58:99:f2:a0
          UP BROADCAST RUNNING SLAVE MULTICAST  MTU:1500  Metric:1
          RX packets:2792839 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3291570 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1690549689 (1.5 GiB)  TX bytes:2662444384 (2.4 GiB)
          Interrupt:28 Base address:0xa000
```

---
---
5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.
---
```buildoutcfg
root@ubuntu-focal:/home/vagrant# ipcalc 10.10.10.0/29
Address:   10.10.10.0           00001010.00001010.00001010.00000 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet

root@ubuntu-focal:/home/vagrant# 
```
Здесь мы видим 6 адресов для хостов. Вместе с адресами подсети и бродкаста всего 8 адресов.

Аналогичным образом получим 256 адресов в 24-й подсетке:
```buildoutcfg
root@ubuntu-focal:/home/vagrant# ipcalc 10.10.10.0/24
Address:   10.10.10.0           00001010.00001010.00001010. 00000000
Netmask:   255.255.255.0 = 24   11111111.11111111.11111111. 00000000
Wildcard:  0.0.0.255            00000000.00000000.00000000. 11111111
=>
Network:   10.10.10.0/24        00001010.00001010.00001010. 00000000
HostMin:   10.10.10.1           00001010.00001010.00001010. 00000001
HostMax:   10.10.10.254         00001010.00001010.00001010. 11111110
Broadcast: 10.10.10.255         00001010.00001010.00001010. 11111111
Hosts/Net: 254                   Class A, Private Internet

root@ubuntu-focal:/home/vagrant#
```
Таким образом, поделив 256 на 8, получим 32 подсети. 

Примеры 29-х подсетей внутри 24-й:
* 10.10.10.0/29
* 10.10.10.8/29
* 10.10.10.16/29
* ...
* 10.10.10.248/29

---
---
6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.
---

В таком случае можно взять адреса из подсети 100.64.0.0/10
```buildoutcfg
root@ubuntu-focal:/home/vagrant# ipcalc -b -s 50 100.64.0.0/10
Address:   100.64.0.0
Netmask:   255.192.0.0 = 10
Wildcard:  0.63.255.255
=>
Network:   100.64.0.0/10
HostMin:   100.64.0.1
HostMax:   100.127.255.254
Broadcast: 100.127.255.255
Hosts/Net: 4194302               Class A

1. Requested size: 50 hosts
Netmask:   255.255.255.192 = 26
Network:   100.64.0.0/26
HostMin:   100.64.0.1
HostMax:   100.64.0.62
Broadcast: 100.64.0.63
Hosts/Net: 62                    Class A

Needed size:  64 addresses.
Used network: 100.64.0.0/26
Unused:
100.64.0.64/26
100.64.0.128/25
100.64.1.0/24
100.64.2.0/23
100.64.4.0/22
100.64.8.0/21
100.64.16.0/20
100.64.32.0/19
100.64.64.0/18
100.64.128.0/17
100.65.0.0/16
100.66.0.0/15
100.68.0.0/14
100.72.0.0/13
100.80.0.0/12
100.96.0.0/11
root@ubuntu-focal:/home/vagrant#
```
Для 50-и хостов можно взять подсеть с 26-й маской.

---
---
7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?
---
Для шиндовс:
```buildoutcfg
C:\Users\Kashnerok>arp -a

Интерфейс: 192.168.2.42 --- 0x3
  адрес в Интернете      Физический адрес      Тип
  192.168.2.1           50-ff-20-0e-a3-92     динамический
  192.168.2.33          2a-d1-27-0d-08-d8     динамический
  192.168.2.45          30-a9-de-d4-03-6c     динамический
  192.168.2.62          2a-d1-27-0d-08-d8     динамический
  192.168.2.64          4c-1b-86-df-c5-ef     динамический
  192.168.2.68          2a-d1-27-0d-08-d8     динамический
  192.168.2.69          b4-6b-fc-e2-5a-f4     динамический
  192.168.2.255         ff-ff-ff-ff-ff-ff     статический
  224.0.0.2             01-00-5e-00-00-02     статический
  224.0.0.22            01-00-5e-00-00-16     статический
  224.0.0.187           01-00-5e-00-00-bb     статический
  224.0.0.250           01-00-5e-00-00-fa     статический
  224.0.0.251           01-00-5e-00-00-fb     статический
  224.0.0.252           01-00-5e-00-00-fc     статический
  239.255.255.250       01-00-5e-7f-ff-fa     статический
  255.255.255.255       ff-ff-ff-ff-ff-ff     статический

Интерфейс: 192.168.56.1 --- 0x1c
  адрес в Интернете      Физический адрес      Тип
  192.168.56.255        ff-ff-ff-ff-ff-ff     статический
  224.0.0.2             01-00-5e-00-00-02     статический
  224.0.0.22            01-00-5e-00-00-16     статический
  224.0.0.187           01-00-5e-00-00-bb     статический
  224.0.0.250           01-00-5e-00-00-fa     статический
  224.0.0.251           01-00-5e-00-00-fb     статический
  224.0.0.252           01-00-5e-00-00-fc     статический
  239.255.255.250       01-00-5e-7f-ff-fa     статический

C:\Users\Kashnerok>
```
Очистить кеш можно командой:
```buildoutcfg
C:\Users\Kashnerok>netsh interface ip delete arpcache
```
Для Linux следующие можно использовать следующие варианты:
```buildoutcfg
root@ubuntu-focal:/home/vagrant# arp
Address                  HWtype  HWaddress           Flags Mask            Iface
_gateway                 ether   52:54:00:12:35:02   C                     enp0s3
root@ubuntu-focal:/home/vagrant#
root@ubuntu-focal:/home/vagrant# ip neigh
10.0.2.2 dev enp0s3 lladdr 52:54:00:12:35:02 REACHABLE
root@ubuntu-focal:/home/vagrant#
```
Очистить кеш:
```buildoutcfg
root@ubuntu-focal:/home/vagrant# ip neigh flush all
```
или:
```buildoutcfg
root@ubuntu-focal:ip link set arp off dev enp0s3 && ip link set arp on dev enp0s3
```
Удалить один адрес:
```buildoutcfg
root@ubuntu-focal:/home/vagrant# sudo arp -d 10.0.2.2
```
